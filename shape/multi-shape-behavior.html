<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../multi-config-behavior.html">
<link rel="import" href="../multi-label-behavior.html">
<link rel="import" href="../multi-svg-util-behavior.html">
<script>
/**
 * `shape` behavior 
 */
(function() {
  'use strict';


  var B = Polymer.multi = Polymer.multi || {};

  var shape = {

    properties: {

      key: {
        type: Function,
        computed: 'computeKey(xAccessor)'
      },

      /**
       * `isDrawning` flag to know if this element is being drawn (e.g. animating). 
       */
      isDrawing: {
        type: Boolean,
        readOnly: true,
        value: false
      },

      /**
       * `isSerie` is a flag to know if this element need to be registered as a serie (e.g. added to serieItems) when it is added to a chart-container
       */
      // isSerie: {
      //   type: Boolean,
      //   value: true
      // },

    },

    fireRefresh: function() {
      this.fire('multi-refresh');
    },

    setTransition: function(chart, duration) {
      var me = this;
      this._setIsDrawing(true);

      chart = chart.transition().duration(duration)
        .on('end', function() {
          me._setIsDrawing(false);
        });
      return chart;

    },

    computeKey: function(accessor) {
      return function(d, i) {
        return accessor(d, i);
      };
    },

    /**
     * `computeDataKey` as computewKey except that we pass d.data (to be used for pie where d3.arc return initial data point under d.data)
     */
    computeDataKey: function(accessor) {
      return function(d, i) {
        return accessor(d.data, i);
      };
    },

    computeAccessor: function(scale, accessor) {
      return function(d, i) {
        return scale(accessor(d, i));
      };
    },

    /**
     * `computeDataAccessor` as computeAccessor except that we pass d.data (to be used for pie where d3.arc return initial data point under d.data)
     */
    computeDataAccessor: function(scale, accessor) {
      return function(d, i) {
        return scale(accessor(d.data, i));
      };
    },

    constant: function(x) {
      return function() {
        return x;
      };
    },

    functor: function(x) {
      return typeof x === 'function' ? x : this.constant(x);
    }

  };

  B.shape = [
    Polymer.multi.config,
    Polymer.multi.label,
    Polymer.multi.svgUtil,
    shape
  ]

})();
</script>
