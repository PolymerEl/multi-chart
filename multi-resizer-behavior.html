<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<script>
(function() {
  'use strict';

  var B = Polymer.multi = Polymer.multi || {};

  var resizer = {

    properties: {
      chartHeight: {
        type: Number,
        readOnly: true,
        notify: true,
        value: 0
      },

      chartWidth: {
        type: Number,
        readOnly: true,
        notify: true,
        value: 0
      },

      margin: {
        type: Object,
        value: function() {
          return {
            top: 20,
            left: 40,
            right: 20,
            bottom: 20
          };
        }
      },

      xCenter: {
        type: Number,
        computed: '__computeCenter(margin.right, chartWidth)'
      },

      yCenter: {
        type: Number,
        computed: '__computeCenter(margin.top, chartHeight)'
      }


    },

    listeners: {
      'iron-resize': '__onIronResize'
    },

    observers: [
      'observeMargin(margin.*)'
    ],

    attached: function() {
      this.calculateSize();
    },

    observeMargin: function(margin) {
      this.calculateSize(margin.base);
    },

    calculateSize: function() {

      this.debounce(this, function() {
        var rect = this.$.svg.getBoundingClientRect();
        this._setChartWidth(Math.floor(rect.width) - this.margin.top - this.margin.bottom);
        this._setChartHeight(Math.floor(rect.height) - this.margin.left - this.margin.right);
        this.fire('multi-resize');
      }, 10);
    },

    __onIronResize: function() {
      this.calculateSize();
    },
    
    __computeCenter: function(margin, size) {
      // return margin + size / 2;
      return margin + size / 2;
    }
  };

  B.resizer = [
    Polymer.IronResizableBehavior,
    resizer
  ]

})();
</script>
