<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../helper/dispatch-svg-mixin.html">
<link rel="import" href="../helper/multi-registerable-mixin.html">
<link rel="import" href="../helper/multi-highlight-mixin.html">
<link rel="import" href="../helper/svg-helper-mixin.html">
<link rel="import" href="../helper/accessor-mixin.html">
<link rel="import" href="../helper/multi-register-mixin.html">
<link rel="import" href="../helper/multi-data-mixin.html">
<link rel="import" href="../multi-chart-base.html">
<dom-module id="multi-container-layer">
  <template>
    <style>
    #observedNode {
      display: none;
    }
    </style>
    <div id="observedNode">
      <slot></slot>
    </div>
    <svg id="svg">
      <g slot-svg="slot-chart" id="slot-layer" class$="[[layer]]"></g>
    </svg>
  </template>
  <script>
  (function() {
    /**
     * # MultiContainerLayer
     * 
     * `<multi-container-layer>` is a proxy for svg g element. 
     * It will be inserted within `multi-container-svg#slot-chart` and can contain other svg content like geo layer. 
     *
     *
     * ### Events
     * Fired when `multi-container-layer` is attached .
     *
     * @event multi-verse-added
     * @param {string} the name of the curret group.
     *
     * Fired when `multi-container-layer` is removed .
     *
     * @event multi-verse-removed
     * @param {string} the name of the current group.
     *
     *
     *
     * @memberof MultiChart
     * @appliesMixin  MultiChart.mixin.SVGHelper    
     * @appliesMixin  MultiChart.mixin.MultiRegister    
     * @appliesMixin  MultiChart.mixin.MultiRegisterable    
     * @appliesMixin  MultiChart.mixin.DispatchSVG    
     * @appliesMixin  MultiChart.mixin.SVGHelper    
     * @appliesMixin  MultiChart.mixin.Resizable    
     * @appliesMixin MultiChart.mixin.Accessor
     * @appliesMixin  MultiChart.mixin.MultiData    
     * @appliesMixin  MultiChart.mixin.PolymerExtends    
     * @customElement
     * @polymer
     **/
    class MultiContainerLayer
    // extends Polymer.mixinBehaviors([Polymer.IronResizableBehavior],
    extends MultiChart.mixin.SVGHelper(
      MultiChart.mixin.DispatchSVG(
        MultiChart.mixin.Resizable(
          MultiChart.mixin.MultiHighlight(
            MultiChart.mixin.Accessor(
              MultiChart.mixin.MultiData(
                MultiChart.mixin.MultiRegister(
                  MultiChart.mixin.MultiRegisterable(
                    MultiChart.MultiChartBase)))))))) {

      static get is() { return 'multi-container-layer'; }

      static get properties() {
        return {

          /**
           * `groupName` the name of the group (used when to registering this element under a multi-verse)
           */
          groupName: {
            type: String
          },

          /* 
           * `layer` the name of the layer - is set to g#svg-slot
           */
          layer: {
            type: String,
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
        Polymer.RenderStatus.afterNextRender(this, () => {
          this.dispatchEvent(new CustomEvent('multi-verse-added', { detail: this.groupName, bubbles: true, composed: true }));
        });
      }

      /* 
       * `dataChanges` relay dataChanged to registeredItems
       */
      dataChanged() {
        this.callRegistered('dataChanged', ...arguments);
      }

      onResize() {
        super.onResize();
        // if(this.svgHost) {
        //   this._setHeight(this.svgHost.height);
        //   this._setWidth(this.svgHost.width);
        // }
        this.callRegistered('onResize');
      }
    }

    customElements.define(MultiContainerLayer.is, MultiContainerLayer);

    if (!window.MultiChart) {
      window.MultiChart = {};
    }

    window.MultiChart.MultiContainerLayer = MultiContainerLayer;

  })();
  </script>
</dom-module>