<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../container/multi-container-axis.html">
<link rel="import" href="../drawable/multi-drawable-line.html">
<link rel="import" href="../d3-scale/multi-scale.html">
<link rel="import" href="multi-chart-property-mixin.html">

<dom-module id="multi-chart-bubble">
	<template>
		<multi-container-axis 
			id="chart"

			top-axis="[[topAxis]]"
			left-axis="[[leftAxis]]"
			bottom-axis="[[bottomAxis]]"
			right-axis="[[rightAxis]]"
			enable-zoom="[[enableZoom]]"
			data="[[data]]"
			series="[[series]]"
			transition="[[transition]]" 
			margin="[[margin]]"
			scales="{{scales}}"
			domains="{{domains}}"
			ranges="{{ranges}}"
			accessors="{{accessors}}"
 			serie-value-domain="{{serieValueDomain}}"
      serie-ordinal-domain="{{serieOrdinalDomain}}"
      serie-domain-mapping="[[serieDomainMapping]]"
      ordinal-domain-mapper="[[ordinalDomainMapper]]"
      
      bottom-scale-type="[[bottomScaleType]]"
      bottom-elastic="[[bottomElastic]]"
      bottom-accessor-path="[[bottomAccessorPath]]"
      bottom-padding="[[bottomPadding]]"
      bottom-domain-min="[[bottomDomainMin]]"
      bottom-domain-max="[[bottomDomainMax]]"
		  bottom-text="[[bottomText]]"
		  bottom-x-text="[[bottomXText]]"
		  bottom-y-text="[[bottomYText]]"
		  bottom-dx="[[bottomDx]]"
		  bottom-dy="[[bottomDy]]"
		  bottom-text-angle="[[bottomTextAngle]]"
		  bottom-ticks="[[bottomTicks]]"
		  bottom-tick-format="[[bottomTickFormat]]"

			right-scale-type="[[rightScaleType]]"
			right-elastic="[[rightElastic]]"
			right-accessor-path="[[rightAccessorPath]]"
			right-padding="[[rightPadding]]"
			right-domain-min="[[rightDomainMin]]"
			right-domain-max="[[rightDomainMax]]"
			right-text="[[rightText]]"
			right-x-text="[[rightXText]]"
			right-y-text="[[rightYText]]"
			right-dx="[[rightDx]]"
			right-dy="[[rightDy]]"
			right-text-angle="[[rightTextAngle]]"
			right-ticks="[[rightTicks]]"
			right-tick-format="[[rightTickFormat]]"

			left-scale-type="[[leftScaleType]]"
			left-elastic="[[leftElastic]]"
			left-accessor-path="[[leftAccessorPath]]"
			left-padding="[[leftPadding]]"
			left-domain-min="[[leftDomainMin]]"
			left-domain-max="[[leftDomainMax]]"
			left-text="[[leftText]]"
			left-x-text="[[leftXText]]"
			left-y-text="[[leftYText]]"
			left-dx="[[leftDx]]"
			left-dy="[[leftDy]]"
			left-text-angle="[[leftTextAngle]]"
			left-ticks="[[leftTicks]]"
			left-tick-format="[[leftTickFormat]]"

			right-scale-type="[[rightScaleType]]"
			right-elastic="[[rightElastic]]"
			right-accessor-path="[[rightAccessorPath]]"
			right-padding="[[rightPadding]]"
			right-domain-min="[[rightDomainMin]]"
			right-domain-max="[[rightDomainMax]]"
			right-text="[[rightText]]"
			right-x-text="[[rightXText]]"
			right-y-text="[[rightYText]]"
			right-dx="[[rightDx]]"
			right-dy="[[rightDy]]"
			right-text-angle="[[rightTextAngle]]"
			right-ticks="[[rightTicks]]"
			right-tick-format="[[rightTickFormat]]"
		>
		<multi-scale 
			scale-type="[[zScaleType]]" 
			domain="[[domains.left]]"  
			range="[[zRange]]" 
			scale="{{zScale}}"
			elastic="{{zElastic}}"
			padding="{{zPadding}}"
			domain-min="[[zDomainMin]]"
			domain-max="[[zDomainMax]]"
		></multi-scale>
    <multi-drawable-bubble 
     	color-scale="[[colorScale]]"
      x-scale="[[scales.bottom]]" 
      y-scale="[[scales.left]]" 
      z-scale="[[zScale]]" 
    ></multi-drawable-bubble>
		<slot name="header" slot="header"></slot>
		<slot></slot>			
	  <slot name="footer" slot="footer"></slot>
		</multi-container-axis>
	</template>

	<script>
		(function() {

		/**
		 * ## MultiChartLine
		 *
		 * `<multi-chart-bubble>` an element for displaying data as a line chart. 
		 * 
		 * ### Example
		 *
		 * ```html
 		 *		<multi-chart-bubble 
     *        color-scale="[[colorScale]]"
     *        data="[[data]]"
     *        left-tick-format="[[leftTickFormat]]">
     *      <dom-repeat items="{{keys}}">
     *        <template>
     *   			<!-- we need a accessor for y-scale -->
     *           <multi-accessor accessor="{{item.accessor}}" path="+value.[[item.key]]"></multi-accessor>
     *           <multi-serie key="[[item.key]]" label="[[item.label]]" accessor="{{item.accessor}}"></multi-serie>
     *       </template>
     *      </dom-repeat>
     *    </multi-chart-bubble>		
     * ```
		 * @memberof MultiChart
		 * @customElement
     * @polymer
     * appliesMixin MultiChart.mixin.MultiChartProperty
     * @appliesMixin MultiChart.mixin.Zoomable
     * @appliesMixin MultiChart.mixin.AxisProperty('bottom')
     * @appliesMixin MultiChart.mixin.AxisProperty('top')
     * @appliesMixin MultiChart.mixin.AxisProperty('left')
     * @appliesMixin MultiChart.mixin.ZoomableProperties
     * @appliesMixin MultiChart.mixin.ContainerAxisProperties
     * @demo index.html#multi-bubble-demo
		 **/
		class MultiChartLine extends 
			MultiChart.mixin.MultiChartProperty(
				MultiChart.mixin.ZoomableProperties(
		      MultiChart.mixin.AxisProperty(
		        MultiChart.mixin.AxisProperty(
		          MultiChart.mixin.AxisProperty(
		            MultiChart.mixin.AxisProperty(
		              Polymer.Element, 'bottom'), 'top'), 'left'), 'right'))) {

			static get is() { return 'multi-chart-bubble'; }

			static get properties() {
				return {

					/* 
					 * `colorScale` colorScale to use for the chart (example d3.scaleOrdinal().range(d3.schemeCategory10);)
					 */
					 colorScale: {
					 	type: Function
					 },

					 /* 
					  * `zScaleType` scaleType for z dimension (size of bubble)
					  */
					 zScaleType: {
            type: String,
            value: 'scaleSqrt',
          },

					/* 
           * `zRange` range for zScale (size of bubble)  
           */
          zElastic: {
            type: Boolean
          },

          /* 
           * `zDomain` domain for zScale. It will be recomputed when data changes
           */
          zDomain: {
            type: Array,
            notify: true,
          },

					/* 
           * `zAccessor` accessor for zScale (size of bubble)  
           */
          zAccessor: {
            type: Function,
            notify: true
          },

					/* 
           * `zRange` range for zScale (size of bubble)  
           */
          zRrange: {
            type: Array,
            value: [3,15]
          },

          /* 
           * `zPadding` padding for zScale (size of bubble)  
           */
          zPadding: {
            type: Number,
          },

          /**
           * `zDomainMin` if set, will be used as the min value for calculating the domain - otherwise, it will be inferred from provided data (`d3.extent(data, accessor)`)
           */
          zDomainMin: {
            type: Number,
            _multiFactory: true
          },

          /**
           * `zDomainMax` if set, will be used as the max value for calculating the domain - otherwise, it will be inferred from provided data (`d3.extent(data, accessor)`)
           */
          zDomainMax: {
            type: Number,
          },

					 /* 
           * `topAxis` true to display top axis
           */
          topAxis: {
            type: Boolean,
            value: false
          },
          
          /* 
           * `rightAxis` true to display right axis
           */
          rightAxis: {
            type: Boolean,
            value: false
          },
          
          /* 
           * `bottomAxis` true to display bottom axis
           */
          bottomAxis: {
            type: Boolean,
            value: true
          },
          
          /* 
           * `leftAxis` true to display left axis
           */
          leftAxis: {
            type: Boolean,
            value: true
          },

	        /* 
	         * `series` 
	         */
	         series : {
	         	type:  Array, 
	         	notify: true
	         },

	        bottomScaleType: {
	        	type: String, 
	        	value: 'scalePoint'
	        }
				};
			}
			connectedCallback() {
        super.connectedCallback();
        Polymer.RenderStatus.afterNextRender(this, () => {
        	this.dispatchEvent(new CustomEvent('iron-resize', {bubble:true, compose:true}));
        	// this.notifyResize();
        });
      }
		}

		customElements.define(MultiChartLine.is, MultiChartLine);

		if (!window.MultiChart) {
		  window.MultiChart = {};
		}
   
   /* 
    * @namespace MultiChart
    */
    window.MultiChart.MultiChartLine = MultiChartLine;

		})();
	</script>
</dom-module>