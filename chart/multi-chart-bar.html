<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../container/multi-container-axis.html">
<link rel="import" href="../drawable/multi-drawable-line.html">
<link rel="import" href="../drawable/color-scale-mixin.html">
<link rel="import" href="../d3-shape/property/d3-shape-stack-mixin.html">
<link rel="import" href="mixin/multi-chart-property-mixin.html">
<link rel="import" href="mixin/multi-chart-axis-property-mixin.html">

<dom-module id="multi-chart-bar">
	<template>
		<multi-container-axis 
			id="chart"
			data-stack

			top-axis="[[topAxis]]"
			left-axis="[[leftAxis]]"
			bottom-axis="[[bottomAxis]]"
			right-axis="[[rightAxis]]"
			enable-zoom="[[enableZoom]]"
			data="[[data]]"
			series="[[series]]"
			transition="[[transition]]" 
			margin="[[margin]]"
			scales="{{scales}}"
			domains="{{domains}}"
			ranges="{{ranges}}"
			accessors="{{accessors}}"
 			serie-value-domain="{{serieValueDomain}}"
      serie-ordinal-domain="{{serieOrdinalDomain}}"
      serie-domain-mapping="[[serieDomainMapping]]"
      ordinal-domain-accessor="[[ordinalDomainAccessor]]"
      
      bottom-scale-type="[[bottomScaleType]]"
      bottom-elastic="[[bottomElastic]]"
      bottom-accessor-path="[[bottomAccessorPath]]"
      bottom-padding="[[bottomPadding]]"
      bottom-domain-min="[[bottomDomainMin]]"
      bottom-domain-max="[[bottomDomainMax]]"
		  bottom-text="[[bottomText]]"
		  bottom-x-text="[[bottomXText]]"
		  bottom-y-text="[[bottomYText]]"
		  bottom-dx="[[bottomDx]]"
		  bottom-dy="[[bottomDy]]"
		  bottom-text-angle="[[bottomTextAngle]]"
		  bottom-ticks="[[bottomTicks]]"
		  bottom-tick-format="[[bottomTickFormat]]"

			right-scale-type="[[rightScaleType]]"
			right-elastic="[[rightElastic]]"
			right-accessor-path="[[rightAccessorPath]]"
			right-padding="[[rightPadding]]"
			right-domain-min="[[rightDomainMin]]"
			right-domain-max="[[rightDomainMax]]"
			right-text="[[rightText]]"
			right-x-text="[[rightXText]]"
			right-y-text="[[rightYText]]"
			right-dx="[[rightDx]]"
			right-dy="[[rightDy]]"
			right-text-angle="[[rightTextAngle]]"
			right-ticks="[[rightTicks]]"
			right-tick-format="[[rightTickFormat]]"

			left-scale-type="[[leftScaleType]]"
			left-elastic="[[leftElastic]]"
			left-accessor-path="[[leftAccessorPath]]"
			left-padding="[[leftPadding]]"
			left-domain-min="[[leftDomainMin]]"
			left-domain-max="[[leftDomainMax]]"
			left-text="[[leftText]]"
			left-x-text="[[leftXText]]"
			left-y-text="[[leftYText]]"
			left-dx="[[leftDx]]"
			left-dy="[[leftDy]]"
			left-text-angle="[[leftTextAngle]]"
			left-ticks="[[leftTicks]]"
			left-tick-format="[[leftTickFormat]]"

			right-scale-type="[[rightScaleType]]"
			right-elastic="[[rightElastic]]"
			right-accessor-path="[[rightAccessorPath]]"
			right-padding="[[rightPadding]]"
			right-domain-min="[[rightDomainMin]]"
			right-domain-max="[[rightDomainMax]]"
			right-text="[[rightText]]"
			right-x-text="[[rightXText]]"
			right-y-text="[[rightYText]]"
			right-dx="[[rightDx]]"
			right-dy="[[rightDy]]"
			right-text-angle="[[rightTextAngle]]"
			right-ticks="[[rightTicks]]"
			right-tick-format="[[rightTickFormat]]"
		>
    <multi-drawable-bar 
     	keys="[[keys]]"
     	value="[[value]]"
     	value-path="[[valuePath]]"
     	offset="[[offset]]"
     	order="[[order]]"
     	color-scale="[[colorScale]]"
      x-scale="[[scales.bottom]]" 
      y-scale="[[scales.left]]" 
      stacked="[[stacked]]"
    ></multi-drawable-bar>
		<slot name="header" slot="header"></slot>
		<slot></slot>			
	  <slot name="footer" slot="footer"></slot>
		</multi-container-axis>
	</template>

	<script>
		(function() {

		/**
		 * ## MultiChartBar
		 *
		 * `<multi-chart-bar>` an element for displaying data as a bar or stack chart. 
		 * 
		 * ### Example
		 *
		 * ```html
 		 *		<multi-chart-bar 
     *        id="chart"  
     *        color-scale="[[colorScale]]"
     *        data="[[data]]"
     * 			  keys="[[keys]]"
     *        left-tick-format="[[leftTickFormat]]">
     *      <dom-repeat items="{{keys}}">
     *        <template>
     *         <!-- set the series inthe markup. We can also pass a series object directly to the chart. -->
     *         <multi-serie key="[[item]]" label="[[item]]"></multi-serie>
     *        </template>
     *      </dom-repeat>
     *    </multi-chart-bar>		
     * ```
		 * @memberof MultiChart
		 * @customElement
     * @polymer
     * appliesMixin MultiChart.mixin.MultiChartProperty
     * @appliesMixin MultiChart.mixin.Zoomable
     * @appliesMixin MultiChart.mixin.AxisProperty('bottom')
     * @appliesMixin MultiChart.mixin.AxisProperty('top')
     * @appliesMixin MultiChart.mixin.AxisProperty('left')
     * @appliesMixin MultiChart.mixin.ZoomableProperty
     * @appliesMixin MultiChart.mixin.ChartAxisProperty
     * @appliesMixin MultiChart.mixin.ColorScale
     * @appliesMixin MultiChart.mixin.D3StackProperty
     * @demo index.html#multi-bar-demo
		 **/
		class MultiChartBar extends 
			MultiChart.mixin.MultiChartProperty(
				MultiChart.mixin.ChartAxisProperty(
					MultiChart.mixin.D3StackProperty(
						MultiChart.mixin.ColorScale(
							MultiChart.mixin.ZoomableProperty(
				      	MultiChart.mixin.AxisProperty(
				        	MultiChart.mixin.AxisProperty(
				          	MultiChart.mixin.AxisProperty(
				            	MultiChart.mixin.AxisProperty(
				              	Polymer.Element, 'bottom'), 'top'), 'left'), 'right')))))) {

			static get is() { return 'multi-chart-bar'; }

			static get properties() {
				return {

					 /* 
           * `stacked` if true, draw a stack chart, otherwise, default bar chart
           */
           stacked : {
             type:  Boolean
             // observer: 'redraw'
            },
        
					 /* 
           * `topAxis` true to display top axis
           */
          topAxis: {
            type: Boolean,
            value: false
          },
          
          /* 
           * `rightAxis` true to display right axis
           */
          rightAxis: {
            type: Boolean,
            value: false
          },
          
          /* 
           * `bottomAxis` true to display bottom axis
           */
          bottomAxis: {
            type: Boolean,
            value: true
          },
          
          /* 
           * `leftAxis` true to display left axis
           */
          leftAxis: {
            type: Boolean,
            value: true
          },

	        /* 
	         * `series` 
	         */
	         series : {
	         	type:  Array, 
	         	notify: true
	         },

	        bottomScaleType: {
	        	type: String, 
	        	value: 'scaleBand'
	        }
				};
			}
			connectedCallback() {
        super.connectedCallback();
        Polymer.RenderStatus.afterNextRender(this, () => {
        	this.dispatchEvent(new CustomEvent('iron-resize', {bubble:true, compose:true}));
        	// this.notifyResize();
        });
      }
		}

		customElements.define(MultiChartBar.is, MultiChartBar);

		if (!window.MultiChart) {
		  window.MultiChart = {};
		}
   
   /* 
    * @namespace MultiChart
    */
    window.MultiChart.MultiChartBar = MultiChartBar;

		})();
	</script>
</dom-module>