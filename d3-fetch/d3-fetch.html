<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../multi-chart/helper/logger-mixin.html">
<dom-module id="d3-fetch">
  <template>
    <style>
    :host {
      display: block;
    }
    </style>
    <h2>Hello [[prop1]]</h2>
  </template>
  <script>
  (function() {

    /**
     * ## 
     *
     * `<d3-fetch>` Base class encapsulating [`d3-fetch`](https://github.com/d3/d3-fetch)
     *
     * @memberof MultiChart
     * @customElement
     * @polymer
     * @appliesMixin MultiChart.mixin.Logger
     * @demo
     **/
    class D3Fetch extends
    MultiChart.mixin.Logger(Polymer.Element) {

      static get is() { return 'd3-fetch'; }

      static get properties() {
        return {

          /* 
           * `url`  the url to fetch data from
           */
          url: {
            type: String
          },

          /* 
           * `data` fetched data
           */
          data: {
            type: Array,
            readOnly: true,
            notify: true
          },

          /* 
           * `error` 
           */
          lastError: {
            type: Object,
            readOnly: true,
            notify: true
          }
        };
      }

      static get observers() {
        return [
          'fetch(url)'
        ];
      }

      /* 
       * `fetcher` the fetcher to use to fetch data (`json, csv, tsv, blob, text, svg, xml`)
       */
      get fetcher() { return 'json'; }

      fetch(url) {
        if (url && this.fetcher) {
          d3[this.fetcher](url)
            .then(data => {
              this._setLastError(null);
              this._setData(data);
            })
            .catch(error => {
              this._setLastError(error);
              this._error(error);
            });
        }
      }
    }

    customElements.define(D3Fetch.is, D3Fetch);

    if (!window.MultiChart) {
      window.MultiChart = {};
    }

    /* 
     * @namespace MultiChart
     */
    window.MultiChart.D3Fetch = D3Fetch;

  })();
  </script>
</dom-module>