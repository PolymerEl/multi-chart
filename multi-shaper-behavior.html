<link rel="import" href="multi-coordinate-grid-behavior.html">
<link rel="import" href="multi-resizer-behavior.html">
<script>
(function() {
  'use strict';

  var B = window.multi = window.multi || {};

  Object.create(null,{foo: { writable: true, configurable: true, value: function(){return 3} },})

  var shaper = {

    properties: {

    },

    attached: function() {
      this.draw();
    },

    draw: function() {
      var me = this;

      var chartSel = d3.select(me.$.chart);
      var contentSel = d3.select(me.$.chartContent);

      var yAccessor = me.yAccessor;
      if (!(yAccessor instanceof Array)) {
        yAccessor = [yAccessor];
      }
      var shaper = yAccessor.map(function(accessor, i) {
        return me.buildShaper(accessor, i);
      });

      function draw(data, i) {

        if (me.chartWidth === 0) {
          return;
        }

        me.handleDomain(data, yAccessor);
        me.handleChartContent(contentSel);

        var chart = chartSel.selectAll('.chart.' + me.chartClass).data(shaper);
        
        chart.exit().remove();

        chart = chart.enter()
          .append(me.chartElement)
          .attr('class', 'chart ' + me.chartClass)
          .merge(chart);

        me.handleChart(chart, data);
        
        me.drawRegistered(data, me.duration);
        me.fire('multi-shaper-draw');
          // me.handleAxis();
        
      }
      // this is the function that is called when we refresh the chart (base-behavior.renderChart(selection))
      this.renderer = function(selection) {
        selection.each(draw);
      };
    },


    getXDomain: function(data) {
      // console.info('Need to override');
    },
    
    handleDomain: function() {
      // console.info('Need to override');
    },

    handleChart: function() {
      // console.info('Need to override');
    },

    handleChartContent: function() {
      // console.info('Need to override');
    },

    buildShaper: function(accessor, i) {
      return this.buildBaseShaper(accessor, i);
    },

    buildBaseShaper: function(accessor, i) {
       var keyAccessor = this.xAccessor;

      return {
        key: function(d, i) {
          return keyAccessor(d, i);
        },
        serie: i
      };
    }

  };

  B.shaper = [
    multi.resizer,
    shaper
  ]

})();
</script>
