<link rel="import" href="../../polymer/polymer.html">
<dom-module id="multi-accessor">
  <script>
  (function() {

    /**
     * ## MultiAccessor
     *
     * `<multi-accessor>` creates an accessor function from a String path
     *
     * @memberof MultiChart
     * @customElement
     * @polymer
     **/
    class MultiAccessor extends Polymer.Element {

      static get is() { return 'multi-accessor'; }

      static get properties() {
        return {
          /**
           * `accessor` the accessor function 
           * example function : `d => {return +d.count}`
           */
          accessor: {
            type: Function,
            notify: true,
          },

          /**
           * `path` the path from which tha accessor function is built
           * For instance `+count` will create `d => {return +d.count}` function.
           */
          path: {
            type: String
          },

          subPath: {
            type: Boolean,
            value: false
          }
        };
      }

      static get observers() {
        return ['_observePath(path, subPath)'];
      }

      _observePath(path, subPath) {
      	if(path) {
	        var isAdd = path.substring(0, 1) === '+';
          path = isAdd ? path.substring(1) : path;
          path = path.split('.').join("']['")
	        var fn;
	        if (subPath) {
	          // fn = new Function('d', 'k', isAdd ? ('return +d.' + path.substring(1)) + '[k]' : ('return d.' + path + '[k]'));
	          fn = new Function('d', 'k', isAdd ? `return +d['${path}'][k]` : `return d['${path}'][k]`);
          } else {
            fn = new Function('d', isAdd ? `return +d['${path}']` : `return d['${path}']`);
	        }
	        this.set('accessor', fn);
	      }
      }
    }

    customElements.define(MultiAccessor.is, MultiAccessor);

    if (!window.MultiChart) {
      window.MultiChart = {};
    }

   /* 
    * @namespace MultiChart
    */
    window.MultiChart.MultiAccessor = MultiAccessor;

  })();
  </script>
</dom-module>