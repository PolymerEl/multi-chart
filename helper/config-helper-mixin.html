<script>
(function() {

  /**
   * ##  ConfigHelper
   * 
   * A helper to handle observers
   * 
   * @memberof MultiChart.mixin   
   * @polymer
   * @mixinFunction
   */
  const ConfigHelper = superClass => {

    return class extends superClass {

      /* 
       * `pauserObserver` call this to cancel observeConfig to run
       */
      pauseObserver() {
        this._pausedObserver = true;
      }

      /* 
       * `activateObserver` make observer functions  active again
       */
      activateObserver() {
        this._pausedObserver = false;
      }

      applyConfig(obj, properties) {
        properties.forEach(function(name) {
          if (this[name] !== undefined && obj[name]) {
            obj[name](this[name]);
          }
        }, this);
      }

      observeConfig(value, name, targetName, eventName) {
        if(this._pausedObserver) {return;}
        let isSplice;
        // Note(cg): value can be a splice if we are observing wildcard (e.g. array.*).
        if(value && value.base && value.path) {
          isSplice = true;
          value = this[name];
        }
        
        if (value || value === 0 || isSplice) {
          var target = this[targetName];
          if (target && target[name]) {
            target[name](value);
            if (eventName) {
               this.dispatchEvent(new CustomEvent(`multi-${eventName}`, {detail: {
                value: value,
                name: name,
                target: targetName
               }, bubbles: true, composed: true})); 
            }
            // this._notifyChange(targetName, null, value);
          } else {
            this._warn(`targetName [${name}] is not a function and config cannot be applied`);
          }
        }
      }
      observeConfigSplices(splice, name, targetName, eventName) {
        if(this._pausedObserver) {return;}
        var value = this[name];
        var target = this[targetName];
        if (target && target[name]) {
          target[name](value);
          if (eventName) {
            this.dispatchEvent(new CustomEvent(`multi-${eventName}`, {detail: {
                value: value,
                name: name,
                target: targetName
               }, bubbles: true, composed: true})); 
          }
        }
      }
    };
  };

  if (!window.MultiChart) {
    window.MultiChart = {};
  }
  /* 
   * @namespace MultiChart.mixin
   */
  window.MultiChart.mixin = window.MultiChart.mixin || {};
  /*
   * @mixinFunction
   */
  window.MultiChart.mixin.ConfigHelper = ConfigHelper;

})();
</script>